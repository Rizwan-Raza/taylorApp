<mat-horizontal-stepper [linear]="false" #stepper class="mat-elevation-z8">
  <mat-step [stepControl]="customerForm" errorMessage="Name and phone number are required." #customer>
    <form [formGroup]="customerForm">
      <ng-template matStepLabel>Customer Information</ng-template>
      <div class="row">
        <div class="col">
          <mat-form-field appearance="outline">
            <mat-label>First name</mat-label>
            <input matInput formControlName="firstName">
            <mat-error *ngIf="customerForm.controls['firstName'].hasError('required')">
              First name is <strong>required</strong>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field appearance="outline">
            <mat-label>Last name</mat-label>
            <input matInput formControlName="lastName">
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <mat-form-field appearance="outline">
            <mat-label>Phone number</mat-label>
            <span matPrefix>+91 &nbsp; </span>
            <input matInput #phoneNumber maxlength="10" type="tel" formControlName="phoneNumber">
            <!-- <mat-error *ngIf="customerForm.controls['phoneNumber'].hasError('required')">
                Address is <strong>required</strong>
              </mat-error> -->
            <mat-hint align="end">{{phoneNumber.value.length}} / 10</mat-hint>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field appearance="outline">
            <mat-label>Email</mat-label>
            <input matInput type="email" formControlName="email">
          </mat-form-field>
        </div>
      </div>
      <mat-form-field appearance="outline">
        <mat-label>Address</mat-label>
        <textarea matInput formControlName="address"></textarea>
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Tailoring</mat-label>
        <input matInput formControlName="tailoring">
        <mat-hint>Customer requested to tailor what?</mat-hint>
      </mat-form-field>
      <div align="end">
        <button mat-raised-button matStepperNext color="primary">Next</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="measurementForm" #measurement>
    <form [formGroup]="measurementForm">
      <ng-template matStepLabel>Measurements</ng-template>
      <mat-grid-list cols="2" rowHeight="130px">
        <mat-grid-tile *ngFor="let card of cards">
          <mat-card class="mat-elevation-z0">
            <div class="row">
              <div class="col">
                <img src="{{card.img}}" width="80px" />
              </div>
              <div class="col">
                <mat-card-header>
                  <mat-card-title>
                    {{card.title}}
                    <button mat-icon-button class="info-button" (click)="openInfoDialog()">
                      <mat-icon>help_outline</mat-icon>
                    </button>
                  </mat-card-title>
                </mat-card-header>
                <mat-card-content>
                  <mat-form-field appearance="outline">
                    <mat-label>Size</mat-label>
                    <input matInput type="number" formControlName="{{card.control}}">
                    <span matSuffix> &nbsp; inches</span>
                  </mat-form-field>
                </mat-card-content>
              </div>
            </div>
          </mat-card>
        </mat-grid-tile>
        <mat-grid-tile [colspan]="2">
          <mat-card class="mat-elevation-z0">
            <mat-card-header>
              <mat-card-title>
                Others
                <!-- <button mat-icon-button class="info-button">
                      <mat-icon>help_outline</mat-icon>
                    </button> -->
              </mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <mat-form-field appearance="outline">
                <mat-label>Other (if any)</mat-label>
                <textarea matInput formControlName="other" rows="1"></textarea>
              </mat-form-field>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
      </mat-grid-list>
      <div align="end">
        <button mat-stroked-button matStepperPrevious color="primary">Back</button>
        <button mat-raised-button matStepperNext color="primary">Next</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="billingForm" errorMessage="Cost is required" #billing>
    <form [formGroup]="billingForm">
      <ng-template matStepLabel>Billing Information</ng-template>
      <div class="row">
        <div class="col">
          <mat-form-field appearance="outline">
            <span matPrefix>₹ &nbsp; </span>
            <mat-label>Total Cost</mat-label>
            <input matInput type="number" formControlName="cost">
            <mat-error *ngIf="billingForm.controls['cost'].hasError('required')">
              Cost is <strong>required</strong>
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col">
          <mat-form-field appearance="outline">
            <mat-label>Payment Method</mat-label>
            <mat-select formControlName="method">
              <mat-option value="cash">Cash</mat-option>
              <mat-option value="upi">UPI</mat-option>
              <mat-option value="other">Other</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <br />
      <div>
        <label>Status: </label>
        <mat-radio-group formControlName="status">
          <mat-radio-button value="pod">Pay On Delivery</mat-radio-button>
          <mat-radio-button value="paid">Paid</mat-radio-button>
          <mat-radio-button value="install">Installment</mat-radio-button>
        </mat-radio-group>
        <mat-form-field appearance="outline" *ngIf="billingForm.controls['status'].value == 'install'">
          <mat-label>Installed Cost</mat-label>
          <span matPrefix>₹ &nbsp; </span>
          <input matInput type="number" formControlName="installment">
        </mat-form-field>
      </div>
      <div align="end">
        <button mat-stroked-button matStepperPrevious color="primary">Back</button>
        <button mat-raised-button matStepperNext color="primary">Next</button>
      </div>
    </form>
  </mat-step>
  <mat-step>
    <ng-template matStepLabel>Done</ng-template>
    <p
      *ngIf="customer.interacted && !customer.hasError && measurement.interacted && !measurement.hasError && billing.interacted && !billing.hasError; else errorBlock">
      You are now done.</p>
    <ng-template #errorBlock>
      <p>Please take all the steps and fill all the required fields</p>
    </ng-template>
    <div class="row">
      <div class="col" align="start">
        <button mat-stroked-button (click)="confirmReset() && stepper.reset()">Reset</button>
      </div>
      <div class="col" align="end">
        <button mat-stroked-button matStepperPrevious color="primary">Back</button>
        <button mat-raised-button (click)="onSubmit()" color="primary"
          [disabled]="!customer.interacted || customer.hasError || !measurement.interacted || measurement.hasError || !billing.interacted || billing.hasError">Submit</button>
      </div>
    </div>
  </mat-step>
</mat-horizontal-stepper>
<div class="top-right">
  <button mat-raised-button color="primary" (click)="stepper.previous()" *ngIf="stepper.selectedIndex!=0;">Back</button>
  <button mat-raised-button (click)="stepper.next()" *ngIf="stepper.selectedIndex!=3; else submitButton;">Next</button>
  <ng-template #submitButton>
    <button (click)="onSubmit()" mat-raised-button
      [disabled]="!customer.interacted || customer.hasError || !measurement.interacted || measurement.hasError || !billing.interacted || billing.hasError">Submit</button>
  </ng-template>
</div>